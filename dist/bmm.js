"use strict";angular.module("bmmLibApp",[]),angular.module("bmmLibApp").directive("bmmPlayerController",["$timeout","bmmUser","bmmPlayer",function(a,b,c){return{template:'<div bmm-video-container></div><div class="bmm-max-width"><div bmm-player-about title=""></div><div class="bmm-player-buttons"><div class="bmm-player-clock" id="clock1">{{clock1 | bmmTime}}</div><div bmm-player-mediaslider></div><div class="bmm-player-clock" id="clock2">{{clock2 | bmmTime}}</div><div bmm-player-maincontrollers></div><div class="bmm-player-tools"><div bmm-track-tools></div><div bmm-volume-controller></div></div></div></div>',compile:function(){return{pre:function(d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u=!1,v=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?!0:!1;v&&$("body").find(".bmm-track-download").css("display","none"),e.addClass("bmm-player-controller"),d.clock1="00:00",d.clock2="00:00",a(function(){k=e.find(".bmm-player-buttons"),l=e.find(".bmm-player-repeat"),m=k.children(".bmm-player-mediaslider"),n=e.find(".bmm-player-shuffle"),o=e.find(".bmm-player-maincontrollers"),p=e.find(".bmm-player-tools"),q=e.find(".bmm-player-about"),r=e.find(".bmm-volume-controller"),s=e.find(".bmm-player-video"),t=e.find(".bmm-video-container"),j=e.parent().find(".bmm-player-target"),e.find(".bmm-player-clock").each(function(a){0===a?h=$(this):i=$(this)}),g=q.outerWidth(),y(),a(function(){w()}),a(function(){d.bmmPlayer=c,d.$watch("bmmPlayer.getCurrentTimePercent",function(a){m.children(".ui-slider-handle").hasClass("ui-state-active")||m.slider("value",a),d.clock1=c.getCurrentTime,d.clock2=c.getDuration()-c.getCurrentTime,y()}),m.slider({slide:function(a,b){c.setCurrentTime(b.value)}})}),s.click(function(){v()});var f=function(){t.attr("active","true"),c.showVideo=!0,e.parent().find(".bmm-video-screen").show().css({width:(b.getScreenHeight()-10)/(9/16),height:b.getScreenHeight()-10,top:10});var a=32;j.animate({height:e.parent().height()-e.height()-b.getScreenHeight()-a},"fast"),t.animate({height:b.getScreenHeight()},"fast",function(){$(window).trigger("resize")})},u=function(){t.attr("active","false"),c.showVideo=!1;var a=32;j.animate({height:e.parent().height()-(e.height()-b.getScreenHeight())-a},"fast"),t.animate({height:0},"fast",function(){e.find(".bmm-video-screen").hide(),$(window).trigger("resize")})},v=function(){"true"===t.attr("active")?u():f()};d.$watch("bmmPlayer.showVideo",function(a){"true"!==t.attr("active")&&a&&f(),"true"!==t.attr("active")||a||u()}),d.file="",d.$watch("bmmPlayer.source",function(a){d.file=a})}),$(window).resize(function(){y(),a(function(){w()})});var w=function(){var a=32;j.css({height:e.parent().outerHeight()-e.outerHeight()-a})},x=function(){f=h.width()+i.width(),f=k.width()-(f+f/1.8),m.width(f).attr("length",f)},y=function(){if(k.width()<1.8*g&&!u){u=!0;var a;q.addClass("bmm-minified"),q.css({padding:".5em 0 0 .8em",height:"","float":"none"}),q.after('<div class="bmm-player-minitimer"></div>'),a=e.find(".bmm-player-minitimer"),h.remove().appendTo(a),a.append("<div>&nbsp/&nbsp</div>"),i.remove().appendTo(a),a.children().css("float","left"),a.css({position:"absolute",top:".5em",right:".8em"}),m.css({width:"","float":"none"})}else k.width()>=2.8*g&&u?(u=!1,h.detach().insertBefore(m).css("float",""),i.detach().insertAfter(m).css("float",""),e.find(".bmm-player-minitimer").remove(),m.css("float",""),q.removeClass("bmm-minified"),q.css({padding:"","float":""}),o.detach().insertAfter(i),x()):k.width()>=1.8*g&&!u&&x()}}}}}}]),angular.module("bmmLibApp").directive("bmmPlayerAbout",[function(){return{template:'<div class="bmm-player-thumbnail" style="background-image: url({{background | bmmCover}});"></div><div class="bmm-player-title"></div><div class="bmm-player-subtitle"></div><div class="bmm-player-extra"></div>',link:function(a,b,c){b.addClass("bmm-player-about");var d=function(){"undefined"!=typeof c.thumbnail&&b.find(".bmm-player-thumbnail").css({background:'url("'+c.thumbnail+'")'}),a.background=c.cover,b.find(".bmm-player-title").append(c.title),b.find(".bmm-player-subtitle").append(c.subtitle),b.find(".bmm-player-extra").append(c.extra),a.$watch("bmmPlayer.getCover",function(b){a.background=b}),a.$watch("bmmPlayer.getTitle",function(a){b.find(".bmm-player-title").html(a)}),a.$watch("bmmPlayer.getSubtitle",function(a){b.find(".bmm-player-subtitle").html(a)}),a.$watch("bmmPlayer.getExtra",function(a){b.find(".bmm-player-extra").html(a)})};d()}}}]),angular.module("bmmLibApp").directive("bmmPlayerMaincontrollers",[function(){return{template:"<div bmm-player-repeat></div><div bmm-player-previous></div><div bmm-player-play></div><div bmm-player-next></div><div bmm-player-shuffle></div>",link:function(a,b){b.addClass("bmm-player-maincontrollers")}}}]),angular.module("bmmLibApp").directive("bmmPlayerMediaslider",["$timeout",function(a){return{template:'<div class="bmm-player-mediaslider-behind"></div>',compile:function(){return{pre:function(b,c){c.addClass("bmm-player-mediaslider");var d=c.find(".bmm-player-mediaslider-behind"),e="";d.css({position:"absolute",bottom:"0"});var f=function(){b.$watch(function(){return c.attr("orientation")},function(){a(function(){g()})})},g=function(){"undefined"!=typeof c.attr("length")&&(e=c.attr("length")),"undefined"!=typeof c.attr("orientation")&&"vertical"===c.attr("orientation")?(c.find(".ui-slider-handle").css({left:""}),c.css({width:"",height:e}),d.css({width:"100%",height:"0"}),c.slider({orientation:"vertical",slide:function(a,b){d.css({height:b.value+"%"})},change:function(a,b){d.css({height:b.value+"%"})}})):(c.css({width:e,height:""}),d.css({width:"0",height:"100%"}),c.slider({orientation:"horizontal",slide:function(a,b){d.css({width:b.value+"%"})},change:function(a,b){d.css({width:b.value+"%"})}}))};f()}}}}}]),angular.module("bmmLibApp").directive("bmmPlayerPlay",["bmmPlayer",function(a){return{link:function(b,c){c.addClass("bmm-player-play"),b.$watch("bmmPlayer.getPlaying",function(a){a?c.addClass("active"):c.removeClass("active")}),c.click(function(){c.hasClass("active")?a.setPause():a.setPlay()})}}}]),angular.module("bmmLibApp").directive("bmmPlayerPrevious",["bmmPlayer",function(a){return{link:function(b,c){c.addClass("bmm-player-previous").click(function(){a.setPrevious()})}}}]),angular.module("bmmLibApp").directive("bmmPlayerNext",["bmmPlayer",function(a){return{link:function(b,c){c.addClass("bmm-player-next").click(function(){a.setNext()})}}}]),angular.module("bmmLibApp").directive("bmmPlayerRepeat",["bmmPlaylist",function(a){return{link:function(b,c){c.addClass("bmm-player-repeat"),c.click(function(){c.hasClass("active")?(a.setRepeat(!1),c.removeClass("active")):(a.setRepeat(!0),c.addClass("active"))})}}}]),angular.module("bmmLibApp").directive("bmmPlayerShuffle",["bmmPlaylist",function(a){return{link:function(b,c){c.addClass("bmm-player-shuffle"),c.click(function(){c.hasClass("active")?(a.setShuffle(!1),c.removeClass("active")):(a.setShuffle(!0),c.addClass("active"))})}}}]),angular.module("bmmLibApp").directive("bmmPlayerVideo",[function(){return{link:function(a,b){b.addClass("bmm-player-video")}}}]),angular.module("bmmLibApp").directive("bmmTrackFavorite",[function(){return{link:function(a,b){b.addClass("bmm-track-favorite")}}}]),angular.module("bmmLibApp").directive("bmmTrackTimer",[function(){return{link:function(a,b){b.addClass("bmm-track-timer")}}}]),angular.module("bmmLibApp").directive("bmmTrackShare",[function(){return{link:function(a,b){b.addClass("bmm-track-share")}}}]),angular.module("bmmLibApp").directive("bmmTrackDownload",[function(){return{link:function(a,b){b.addClass("bmm-track-download")}}}]),angular.module("bmmLibApp").directive("bmmTrackTools",[function(){return{template:'<div bmm-track-favorite></div><div bmm-track-timer></div><div bmm-track-share></div><a download href="{{file}}"><div bmm-track-download></div></a><div bmm-player-video></div>',link:function(a,b){b.addClass("bmm-track-tools")}}}]),angular.module("bmmLibApp").directive("bmmVideoContainer",["$timeout","bmmUser",function(a,b){return{template:"<div bmm-video-screen></div>",compile:function(){return{pre:function(c,d){var e;d.addClass("bmm-video-container"),a(function(){e=d.find(".bmm-video-screen"),g(),d.resize(function(){g(),f()})});var f=function(){e.css("top",10),e.height(d.height()-10),e.width(d.height()/(9/16))},g=function(){d.resizable({handles:"n",resize:function(a,c){d.css("top",""),d.attr("active","true"),b.setScreenHeight(c.size.height),e.show()}})}}}}}}]),angular.module("bmmLibApp").directive("bmmVideoScreen",["$compile","bmmPlayer",function(a,b){return{template:'<div class="bmm-video-target"></div>',compile:function(){return{pre:function(a,b){b.addClass("bmm-video-screen")},post:function(c,d){b.initialize(".bmm-video-target"),d.find(".bmm-video-target").append(a("<div bmm-video-fullscreen></div><div bmm-player-fullscreen></div>")(c))}}}}}]),angular.module("bmmLibApp").directive("bmmVideoFullscreen",["bmmPlayer","$timeout",function(a,b){return{template:'<div class="bmm-video-fullscreen-buttons"><div bmm-player-previous></div><div bmm-player-play></div><div bmm-player-next></div><p>{{clock1 | bmmTime}} / {{clock2 | bmmTime}}</p><div bmm-volume-controller></div></div><div class="bmm-video-fullscreen-slider"><div bmm-player-mediaslider></div></div>',compile:function(){return{pre:function(c,d){d.addClass("bmm-video-fullscreen"),d.addClass("hide");var e=b(function(){d.fadeOut("slow")},2e3);$(window).on("mousemove click",function(){d.show(),b.cancel(e),e=b(function(){d.fadeOut("slow")},2e3)});var f;b(function(){b(function(){f=d.find(".bmm-video-fullscreen-slider").find(".bmm-player-mediaslider"),c.bmmPlayer=a,c.$watch("bmmPlayer.getCurrentTimePercent",function(b){f.children(".ui-slider-handle").hasClass("ui-state-active")||f.slider("value",b),c.clock1=a.getCurrentTime,c.clock2=a.getDuration()-a.getCurrentTime}),f.slider({slide:function(b,c){a.setCurrentTime(c.value)}}),c.$watch("bmmPlayer.getFullscreen",function(a){"on"===a?d.removeClass("hide"):d.addClass("hide")})})})}}}}}]),angular.module("bmmLibApp").directive("bmmVolumeController",["$timeout",function(a){return{template:"<div bmm-volume-mute></div><div bmm-volume-slider></div><div bmm-volume-max></div>",compile:function(){return{pre:function(b,c){var d;c.addClass("bmm-volume-controller"),a(function(){d=c.find(".bmm-volume-slider"),c.children().css("float","left")})}}}}}]),angular.module("bmmLibApp").directive("bmmVolumeSlider",["$timeout","bmmPlayer",function(a,b){return{template:'<div bmm-player-mediaslider class="bmm-minified"></div>',compile:function(){return{pre:function(c,d){var e,f="5em";d.addClass("bmm-volume-slider"),a(function(){e=d.find(".bmm-player-mediaslider"),e.attr("length",f),c.$watch(function(){return d.attr("")},function(){"undefined"!=typeof d.attr("length")&&(f=d.attr("length")),e.attr("length",f),g()})});var g=function(){a(function(){a(function(){var a=d.find(".bmm-player-mediaslider");c.bmmPlayer=b,c.$watch("bmmPlayer.getVolume",function(b){a.children(".ui-slider-handle").hasClass("ui-state-active")||a.slider("value",100*b)}),a.slider({slide:function(a,c){b.setVolume(c.value/100)}})})})}}}}}}]),angular.module("bmmLibApp").directive("bmmVolumeMute",["bmmPlayer",function(a){return{link:function(b,c){c.addClass("bmm-volume-mute").click(function(){a.setMute()}),c.click(function(){c.toggleClass("muted")})}}}]),angular.module("bmmLibApp").directive("bmmVolumeMax",["bmmPlayer",function(a){return{link:function(b,c){c.addClass("bmm-volume-max"),c.click(function(){a.setMute(!1),a.setVolume(1)})}}}]),angular.module("bmmLibApp").directive("bmmResize",[function(){return{link:function(a,b){b.resizable()}}}]),angular.module("bmmLibApp").directive("bmmContainerMain",["$timeout",function(a){return{compile:function(){return{pre:function(b,c){var d=!1,e=$(".bmm-container-header.main"),f=$(".bmm-navigator-playlist"),g=$(".bmm-navigator-backend"),h=$(".bmm-player-target"),i=$(".bmm-view");c.addClass("bmm-container-main"),$(c).bind("scroll",function(){$(this).scrollTop()+$(this).innerHeight()>=$(this)[0].scrollHeight&&$(".bmm-view").trigger("scrollBottom")}),$(c.find(".bmm-view")).bind("scroll",function(){$(this).scrollTop()+$(this).innerHeight()>=$(this)[0].scrollHeight&&$(".bmm-view").trigger("scrollBottom")}),"none"===e.css("display")&&(d=!0,b.miniScreen=!0,a(function(){j()},1500)),$(window).resize(function(){("none"===e.css("display")||f.hasClass("fixed")||g.hasClass("fixed"))&&j(),"none"!==e.css("display")||d?d&&"none"!==e.css("display")&&(d=!1,b.miniScreen=!1,f.css({height:""}),g.css({height:""})):(d=!0,b.miniScreen=!0,j())}),$(".bmm-player-target").scroll(function(){"none"!==e.css("display")&&((!f.hasClass("fixed")||!g.hasClass("fixed"))&&h.scrollTop()>=e.height()&&f.height()<i.height()?(f.addClass("fixed"),g.addClass("fixed"),j()):(f.hasClass("fixed")||g.hasClass("fixed"))&&h.scrollTop()<e.height()&&(f.removeClass("fixed").css({height:""}),g.removeClass("fixed").css({height:""})))});var j=function(){f.css({height:h.height()}),g.css({height:h.height()})}}}}}}]),angular.module("bmmLibApp").factory("bmmUser",[function(){var a,b={},c={},d="main",e=!0,f=!1,g={};return c.screen={},c.screen.height="180",c.screen.width="180",b.getScreenWidth=function(){return c.screen.width},b.getScreenHeight=function(){return c.screen.height},b.getCurrentNavigator=function(){return d},b.setScreenWidth=function(a){c.screen.width=a},b.setScreenHeight=function(a){c.screen.height=a},b.setCurrentNavigator=function(a){d=a},b.displayNavigator=function(a){return"undefined"!=typeof a&&(e=a),e},b.mediaLanguage="nb",b.setMediaLanguage=function(a){f=!0,b.mediaLanguage=a},b.mediaLanguageIsSet=function(){return f},b.setTranslation=function(a){g=a},b.getTranslation=function(){return g},b.setUsername=function(b){a=b},b.getUsername=function(){return a},b}]),angular.module("bmmLibApp").factory("bmmPlaylist",[function(){var a={},b="",c=!1,d=!1,e=[];return a.setTracks=function(c){return"undefined"==typeof c.tracks?!1:($.isArray(c.tracks)||(c.tracks=[c.tracks]),e=c.tracks,a.index="undefined"!=typeof c.index&&(c.index>=0||c.index<e.length)?c.index:0,b="undefined"!=typeof c.url?c.url:!1,void 0)},a.setShuffle=function(a){return c="undefined"!=typeof a?a:!c},a.setRepeat=function(a){return d="undefined"!=typeof a?a:!d},a.getUrl=function(){return b},a.getDuration=function(){if("undefined"!=typeof e){var a=0;return $.each(e,function(){a+=this.duration}),a}return!1},a.getCurrent=function(){return e.length?e[a.index]:!1},a.getNext=function(){return c?(a.index=Math.floor(Math.random()*e.length),a.getCurrent()):a.index<e.length-1?(a.index++,a.getCurrent()):d?(a.index=0,a.getCurrent()):!1},a.getPrevious=function(){return a.index>0?(a.index--,a.getCurrent()):d?(a.index=e.length-1,a.getCurrent()):!1},a.index=0,a}]),angular.module("bmmLibApp").factory("bmmPlayer",["bmmPlaylist","$timeout","$rootScope",function(a,b,c){var d,e,f={};return f.initialize=function(b){"undefined"!=typeof b&&(d=b),"undefined"!=typeof d&&$(d).jPlayer({ready:function(b){f.setSource(a.getCurrent()),f.getVolume=b.jPlayer.options.volume},swfPath:"bower_components/jplayer/jquery.jplayer/Jplayer.swf",supplied:"m4v, mp3",seeking:function(){},seeked:function(){},canplay:function(){},timeupdate:function(){c.safeApply(function(){f.getCurrentTime=$(d).data("jPlayer").status.currentTime,f.getCurrentTimePercent=$(d).data("jPlayer").status.currentPercentAbsolute})},ended:function(){f.setNext(!0)},resize:function(){c.$apply(function(){f.getFullscreen="off"===f.getFullscreen?"on":"off"})},size:{width:"100%",height:"100%"}})},f.setPlay=function(){$(d).jPlayer("play"),f.getPlaying=!0},f.setPause=function(){$(d).jPlayer("pause"),f.getPlaying=!1},f.setStop=function(){$(d).jPlayer("stop"),f.getPlaying=!1},f.setNext=function(b){var c=a.getNext();c!==!1&&(f.setSource(c),"undefined"!=typeof b&&b&&f.setPlay())},f.setPrevious=function(){var b=a.getPrevious();b!==!1&&f.setSource(b)},f.setMute=function(a){"undefined"!=typeof a?a?$(d).jPlayer("mute"):$(d).jPlayer("unmute"):$(d).data("jPlayer").options.muted?$(d).jPlayer("unmute"):$(d).jPlayer("mute")},f.setFullscreen=function(a){return"undefined"!=typeof a?$(d).jPlayer({fullScreen:a}):a="off"===f.getFullscreen?!0:!1,$(d).jPlayer({fullScreen:a}),a},f.setVolume=function(a){$(d).jPlayer("volume",a),f.getVolume=a},f.setSource=function(a){var b=$(d).data("jPlayer").status.paused;e=a,f.getCover=a.cover,f.getTitle=a.title,f.getSubtitle=a.subtitle,f.getExtra=a.extra,f.source=e.url,e.video?($(d).jPlayer("setMedia",{m4v:e.url,poster:f.getCover}),f.showVideo=!0):$(d).jPlayer("setMedia",{mp3:e.url,poster:f.getCover}),b||f.setPlay(),f.getTrackCount++},f.setCurrentTime=function(a){$(d).jPlayer("playHead",a)},f.getDuration=function(){return $(d).data("jPlayer").status.duration},f.getCurrentTime=0,f.getCurrentTimePercent=0,f.getVolume=0,f.getCover="",f.getTitle="",f.getSubtitle="",f.getExtra="",f.getFullscreen="off",f.showVideo=!1,f.source="",f.getPlaying=!1,f.getTrackCount=0,c.safeApply=function(a){var b=this.$root.$$phase;"$apply"===b||"$digest"===b?a&&"function"==typeof a&&a():this.$apply(a)},f}]),angular.module("bmmLibApp").factory("bmmApi",[function(){var a={},b="localhost/";return a.serverUrl=function(a){b=a},a.getserverUrli=function(){return b},a.root=function(){return $.ajax({method:"GET",crossDomain:!0,url:b,dataType:"json"}).fail(function(a){console.log(a)})},a.albumPost=function(a){return"undefined"==typeof a&&(a={}),$.ajax({method:"POST",url:b+"album/",data:JSON.stringify(a),contentType:"application/json",dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0}).fail(function(a){console.log(a)})},a.albumLatest=function(a,c){return"undefined"==typeof a&&(a={}),"undefined"==typeof c&&(c=""),$.ajax({method:"GET",url:b+"album",headers:{"Accept-Language":c},data:$.param(a),dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0}).fail(function(a){console.log(a)})},a.albumPublishedYear=function(a,c,d){return"undefined"==typeof c&&(c={}),"undefined"==typeof d&&(d=""),$.ajax({method:"GET",url:b+"album/published/"+a,headers:{"Accept-Language":d},data:$.param(c),dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0}).fail(function(a){console.log(a)})},a.albumTracksRecordedYear=function(a,c,d){return"undefined"==typeof c&&(c={}),"undefined"==typeof d&&(d=""),$.ajax({method:"GET",url:b+"album/tracks_recorded/"+a,headers:{"Accept-Language":d},data:$.param(c),dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0}).fail(function(a){console.log(a)})},a.albumGet=function(a,c,d){return"undefined"==typeof d&&(d={}),"undefined"==typeof c&&(c=""),$.ajax({method:"GET",url:b+"album/"+a,headers:{"Accept-Language":c},data:$.param(d),dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0}).fail(function(a){console.log(a)})},a.albumPut=function(a,c){return"undefined"==typeof c&&(c={}),$.ajax({method:"PUT",url:b+"album/"+a,data:JSON.stringify(c),contentType:"application/json",dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0}).fail(function(a){console.log(a)})},a.albumDelete=function(a){return $.ajax({method:"DELETE",url:b+"album/"+a,dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0}).fail(function(a){console.log(a)})},a.facetsAlbumPublishedYears=function(a){return"undefined"==typeof a&&(a={}),$.ajax({method:"GET",url:b+"facets/album_published/years",data:$.param(a),dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0}).fail(function(a){console.log(a)})},a.facetsTrackRecordedYears=function(a){return"undefined"==typeof a&&(a={}),$.ajax({method:"GET",url:b+"facets/track_recorded/years",data:$.param(a),dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0}).fail(function(a){console.log(a)})},a.loginAuthentication=function(a){return"undefined"==typeof a&&(a={}),$.ajax({method:"POST",url:b+"login/authentication",data:JSON.stringify(a),contentType:"application/json",dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0}).fail(function(a){console.log(a)})},a.loginRedirect=function(){window.location=b+"login/redirect?redirect_to="+window.location},a.search=function(a,c,d){return"undefined"==typeof c&&(c={}),"undefined"==typeof d&&(d=""),$.ajax({method:"GET",url:b+"search/"+a,headers:{"Accept-Language":d},data:$.param(c),dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0}).fail(function(a){console.log(a)})},a.suggest=function(a,c){return"undefined"==typeof c&&(c=""),$.ajax({method:"GET",url:b+"suggest/"+a,headers:{"Accept-Language":c},dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0}).fail(function(a){console.log(a)})},a.track=function(a){return"undefined"==typeof a&&(a={}),$.ajax({method:"POST",url:b+"track",data:JSON.stringify(a),contentType:"application/json",dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0}).fail(function(a){console.log(a)})},a.trackLatest=function(a,c){return"undefined"==typeof a&&(a={}),"undefined"==typeof c&&(c=""),$.ajax({method:"GET",url:b+"track",headers:{"Accept-Language":c},data:$.param(a),dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0}).fail(function(a){console.log(a)})},a.trackRel=function(a,c,d){return"undefined"==typeof c&&(c={}),"undefined"==typeof d&&(d=""),$.ajax({method:"GET",url:b+"track/rel/"+a,headers:{"Accept-Language":d},data:$.param(c),dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0}).fail(function(a){console.log(a)})},a.trackGet=function(a,c,d){return"undefined"==typeof c&&(c=""),"undefined"==typeof d&&(d={}),$.ajax({method:"GET",url:b+"track/"+a,headers:{"Accept-Language":c},data:$.param(d),dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0}).fail(function(a){console.log(a)})},a.trackPut=function(a,c){return"undefined"==typeof c&&(c={}),$.ajax({method:"PUT",url:b+"track/"+a,data:JSON.stringify(c),contentType:"application/json",dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0}).fail(function(a){console.log(a)})},a.trackDelete=function(a){return $.ajax({method:"DELETE",url:b+"track/"+a,dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0}).fail(function(a){console.log(a)})},a.trackFiles=function(a,c,d){return $.ajax({method:"POST",url:b+"track/"+a+"/files",file:d,dataType:"json",data:JSON.stringify({type:c}),contentType:"application/json",xhrFields:{withCredentials:!0},crossDomain:!0}).fail(function(a){console.log(a)})},a.user=function(){return $.ajax({method:"GET",url:b+"login/user",dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0}).fail(function(a){console.log(a)})},a.userTrackCollectionPost=function(a){return"undefined"==typeof a&&(a={}),$.ajax({method:"POST",url:b+"track_collection/",data:JSON.stringify(a),contentType:"application/json",dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0}).fail(function(){})},a.userTrackCollectionLink=function(a,c,d){return"undefined"==typeof c&&(c={}),$.ajax({method:"POST",url:b+"track_collection/"+a+"?_method=LINK",beforeSend:function(a){$.each(c,function(){a.setRequestHeader("Link","<"+b+"track/"+this+">")}),a.setRequestHeader("Accept-Language",d)},dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0}).fail(function(){})},a.userTrackCollectionGet=function(a){return $.ajax({method:"GET",url:b+"track_collection/"+a,dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0}).fail(function(a){console.log(a)})},a.userTrackCollectionPut=function(a,c){return"undefined"==typeof c&&(c={}),c.type="track_collection",$.ajax({method:"PUT",url:b+"track_collection/"+a,data:JSON.stringify(c),contentType:"application/json",dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0}).fail(function(){})},a.userTrackCollectionDelete=function(a){return $.ajax({method:"DELETE",url:b+"track_collection/"+a,dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0}).fail(function(){})},a.contributorGet=function(a){return"undefined"==typeof a&&(a={}),$.ajax({method:"GET",url:b+"contributor",data:$.param(a),dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0}).fail(function(a){console.log(a)})},a.contributorPost=function(a){return"undefined"==typeof a&&(a={}),$.ajax({method:"POST",url:b+"contributor",data:JSON.stringify(a),contentType:"application/json",dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0}).fail(function(a){console.log(a)})},a.contributorIdGet=function(a){return $.ajax({method:"GET",url:b+"contributor/"+a,dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0}).fail(function(a){console.log(a)})},a.contributorIdPut=function(a,c){return"undefined"==typeof c&&(c={}),$.ajax({method:"PUT",url:b+"contributor/"+a,data:JSON.stringify(c),contentType:"application/json",dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0}).fail(function(a){console.log(a)})},a.contributorIdDelete=function(a){return $.ajax({method:"DELETE",url:b+"contributor/"+a,dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0}).fail(function(a){console.log(a)})},a.contributorTracksGet=function(a,c){return"undefined"==typeof c&&(c={}),$.ajax({method:"GET",url:b+"contributor/"+a+"/track/",data:$.param(c),dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0}).fail(function(a){console.log(a)})},a}]),angular.module("bmmLibApp").factory("bmmShuffle",[function(){var a=function(a){for(var b,c,d=a.length;0!==d;)b=Math.floor(Math.random()*d),d-=1,c=a[d],a[d]=a[b],a[b]=c;return a};return a}]),angular.module("bmmLibApp").directive("bmmPlaylist",["$rootScope","bmmApi",function(a,b){return{link:function(c,d){c.sortableOptions={update:function(){c.$apply("playlist")},handle:".sort",axis:"y"},d.addClass("bmm-playlist"),$(".bmm-playlist").on("dragdrop",function(){h()}),c.$watch("playlist",function(){h()}),d.click(function(){d.toggleClass("active")});var e,f,g,h=function(){d.find("tbody").find("tr").each(function(){$(this).draggable({handle:".drag",helper:"clone",appendTo:".bmm-main-container",revert:"invalid",scope:"move",scroll:!0,start:function(a,b){e=b.position.top,f=$(".bmm-container-main").scrollTop(),g=a.pageY},drag:function(a,b){b.position.top=e+$(".bmm-container-main").scrollTop()-f+a.pageY-g},cursorAt:{left:2,top:2}})}),$("body").find(".bmm-playlist-private").droppable({scope:"move",activeClass:"active",hoverClass:"hover",tolerance:"pointer",drop:function(c,d){b.userTrackCollectionLink($(this).attr("id"),[d.draggable.attr("id")],d.draggable.attr("language")).fail(function(){a.$apply()})}})}}}}]),angular.module("bmmLibApp").directive("bmmPath",["$location","$compile",function(a,b){return{compile:function(){return{pre:function(c,d){function e(a){return a=a.replace(":",""),a.substr(0,1).toUpperCase()+a.substr(1)}d.addClass("bmm-path");var f,g=a.path().split("/"),h="";$.each(g,function(a){f=e(this),h+=this+"/",a===g.length-1&&1!==a?d.append('<div class="bmm-pointer"> > </div>'+f):a===g.length-1?d.append(f):1===a?d.append('<a ng-href="#'+h+'">'+f+"</a>"):a>1&&d.append('<div class="bmm-pointer"> > </div><a ng-href="#'+h+'">'+f+"</a>")}),b(d.contents())(c)}}}}}]),angular.module("bmmLibApp").factory("bmmIndex",[function(){var a={};return a.prev=function(a,b,c,d){return"undefined"==typeof d&&(d=0),a>=c+d?a-c:b-(c-a)},a.next=function(a,b,c){return b>=a+c?a+c:a+c-b},a}]),angular.module("bmmLibApp").directive("bmmSliderImage",["$timeout",function(a){return{link:function(b,c){c.addClass("bmm-slider-image"),c.append('<div class="bmm-slider-image-prev"></div>'),c.append('<div class="bmm-slider-image-next"></div>');var d=c.find(".bmm-slider-image-prev"),e=c.find(".bmm-slider-image-next"),f=0;d.click(function(){f>0&&(f--,g(!0))}),e.click(function(){c.find("li").length-1>f&&(f++,g(!0))}),a(function(){g(),c.height(c.find("li").width()/2.8),d.css({top:c.height()/2-d.height()/2}),e.css({top:c.height()/2-e.height()/2})}),$(window).resize(function(){g(),c.height(c.find("li").width()/2.8),d.css({top:c.height()/2-d.height()/2}),e.css({top:c.height()/2-e.height()/2})});var g=function(a){c.find("li").each(function(b){"undefined"!=typeof a&&a?$(this).animate({left:$(this).width()*b-$(this).width()*f},"fast"):$(this).css({left:$(this).width()*b-$(this).width()*f})})}}}}]),angular.module("bmmLibApp").directive("bmmSliderAlbum",["$timeout",function(a){return{link:function(b,c){c.addClass("bmm-slider-album"),c.append('<div class="bmm-slider-album-prev"></div>'),c.append('<div class="bmm-slider-album-next"></div>');var d,e=c.find(".bmm-slider-album-prev"),f=c.find(".bmm-slider-album-next"),g=0;e.click(function(){g>0&&(g--,h(!0))}),f.click(function(){c.find("li").length>4*g+4&&(g++,h(!0))}),a(function(){h(),e.css({top:c.height()/2-e.height()/2}),f.css({top:c.height()/2-f.height()/2})}),$(window).resize(function(){h(),e.css({top:c.height()/2-e.height()/2}),f.css({top:c.height()/2-f.height()/2})});var h=function(a){var b=.23*c.find("ul").width(),e=b;d=.08*c.find("ul").width()/5,c.height(e+.1*b),c.find("li").css({width:b,height:e}),c.find("li").each(function(b){0===$(this).find(".shadow").length&&$(this).append('<div class="shadow"></div>'),"undefined"!=typeof a&&a?$(this).animate({left:($(this).width()+d)*b-4*($(this).width()+d)*g+d},"fast"):$(this).css({left:($(this).width()+d)*b-4*($(this).width()+d)*g+d})})}}}}]),angular.module("bmmLibApp").directive("bmmSliderVideo",["$timeout",function(a){return{link:function(b,c){c.addClass("bmm-slider-video"),c.append('<div class="bmm-slider-video-prev"></div>'),c.append('<div class="bmm-slider-video-next"></div>'),c.append('<div class="bmm-video-shadow"></div>');var d,e=c.find(".bmm-videos"),f=c.find(".bmm-slider-video-prev"),g=c.find(".bmm-slider-video-next"),h=function(){e.children().length?(d=e.find(">:nth-child(1)"),e.children().each(function(){$(this).zIndex(0)}),e.children().length>2&&e.children().last().zIndex(2).addClass("left"),d.zIndex(3).addClass("middle"),e.children().length>1&&d.next().zIndex(2).addClass("right")):a(function(){h()},500)};h(),f.click(function(){var a,b,c;e.children().each(function(){$(this).zIndex()<=1&&$(this).zIndex(0)}),e.children().length>=3?(d.is(":last-child")?(a=e.find("> div:first-child"),b=a.next(),c=d.prev()):d.next().is(":last-child")?(a=d.next(),b=e.find("> div:first-child"),c=d.prev()):d.is(":first-child")?(a=d.next(),b=a.next(),c=e.find("> div:last-child")):(a=d.next(),b=a.next(),c=d.prev()),c.zIndex(1),d.zIndex(2),a.zIndex(4),b.zIndex(2),c.removeClass("left"),d.removeClass("middle"),a.removeClass("right"),d.addClass("left"),a.addClass("middle"),b.addClass("right"),d=a):d.is(":last-child")||(d.zIndex(2).removeClass("middle").addClass("left"),d.next().zIndex(3).removeClass("right").addClass("middle"),d=d.next())}),g.click(function(){var a,b,c;e.children().each(function(){$(this).zIndex()<=1&&$(this).zIndex(0)}),e.children().length>=3?(d.is(":first-child")?(a=e.find("> div:last-child"),b=a.prev(),c=d.next()):d.prev().is(":first-child")?(a=d.prev(),b=e.find("> div:last-child"),c=d.next()):d.is(":last-child")?(a=d.prev(),b=a.prev(),c=e.find("> div:first-child")):(a=d.prev(),b=a.prev(),c=d.next()),c.zIndex(1),d.zIndex(2),a.zIndex(3),b.zIndex(2),c.removeClass("right"),d.removeClass("middle"),a.removeClass("left"),d.addClass("right"),a.addClass("middle"),b.addClass("left"),d=a):d.is(":first-child")||(d.zIndex(2).removeClass("middle").addClass("right"),d.prev().zIndex(3).removeClass("left").addClass("middle"),d=d.prev())}),a(function(){c.height(c.width()/2.8),f.css({top:c.height()/2-f.height()/1.3}),g.css({top:c.height()/2-g.height()/1.3})}),$(window).resize(function(){c.height(c.width()/2.8),f.css({top:c.height()/2-f.height()/1.3}),g.css({top:c.height()/2-g.height()/1.3})})}}}]),angular.module("bmmLibApp").factory("bmmTranslation",[function(){var a={};return a.getTranslation=function(a){return $.ajax(a+".json").fail(function(a){console.log(a)})},a}]),angular.module("bmmLibApp").factory("bmmRelation",[function(){var a={};return a.filter=function(a,b){if("undefined"==typeof b||""===b||b===[])return!1;var c=[],d=[];return $.each(a,function(){d=this,$.isArray(b)?$.each(b,function(){d.type===this&&c.push(d)}):d.type===b&&c.push(d)}),c},a}]),angular.module("bmmLibApp").filter("bmmTime",function(){return function(a){var b=function(a){var b=0,c=0;for("undefined"==typeof a&&(a=0),a=parseInt(a,10);a>=60;)a>=3600?(b+=1,a-=3600):(c+=1,a-=60);
return 9>=b&&(b="0"+b),9>=c&&(c="0"+c),9>=a&&(a="0"+a),"00"===b?b="":b+=":",c+=":",b&&c&&0===a&&(a=""),b+c+a};return b(a)}}),angular.module("bmmLibApp").filter("bmmBibleVerse",["bmmTranslator",function(a){return function(b){var c=[];if("undefined"!=typeof b&&""!==b){var d={};$.each(a.getBible().books,function(a){var b=this.toLowerCase();b=b.replace(/[\s\.¦:;¶*~"'_\\\/\-\,><!$£#¤%&=+?|{}\[\]¨^`´@]/g,""),d[a]=b}),b=b.toLowerCase(),b=b.replace(/[\.\s]/g,""),b=b.split("|"),$.each(b,function(){var b,e,f={};b=this,e=-1;for(var g=0;g<b.length;g++)if(g>1&&b[g].match(/^\d+$/)){e=g-1;break}-1===e?(f.name=b,b=""):(f.name=b.substring(0,e+1),b=b.substring(e+1)),f.name=f.name.replace(/[¦:;¶*~"'_\\\/\-\,><!$£#¤%&=+?|{}\[\]¨^`´@]/g,""),f.chapters=[],b=b.replace(/[;+\,]/g,":"),b=b.replace(/[^0-9&:\-]/g,""),$.each(b.split("&"),function(){var a=this.split(":"),b={};b.verses=[],$.each(a,function(a){if(0===a&&this>0)b.number=Number(this);else if(-1===this.indexOf("-"))this>0&&-1===$.inArray(Number(this),b.verses)&&b.verses.push(Number(this));else{var c=this.split("-");if(""!==c[0]){(""===c[1]||parseInt(c[1],10)<parseInt(c[0],10))&&(c[1]=c[0]);for(var d=parseInt(c[0],10);d<=parseInt(c[1],10);d++)d>0&&-1===$.inArray(Number(d),b.verses)&&b.verses.push(Number(d))}}}),f.chapters.push(b)}),$.each(d,function(b){return-1!==this.indexOf(f.name)?(f.name=this,f.shortcode=a.getBible().shortcodes[b],f.key=b,c.push(f),!1):void 0})})}return c}}]),angular.module("bmmLibApp").factory("bmmTranslator",function(){var a={},b={},c={};return a.set=function(a){b=a},a.get=function(){return b},a.setBible=function(a){c=a},a.getBible=function(){return c},a}),angular.module("bmmLibApp").directive("bmmPlayerFullscreen",["bmmPlayer","$timeout",function(a,b){return{link:function(c,d){d.addClass("bmm-player-fullscreen"),d.click(function(){var b=a.setFullscreen();b?d.addClass("active"):d.removeClass("active")});var e=b(function(){d.fadeOut("slow")},2e3);$(window).on("mousemove click",function(){d.show(),b.cancel(e),e=b(function(){d.fadeOut("slow")},2e3)})}}}]),angular.module("bmmLibApp").filter("bmmMin",function(){return function(a,b){return"undefined"==typeof b&&(b=15),a.length>b&&(a=a.substring(0,b)+"..."),a}}),angular.module("bmmLibApp").filter("bmmLanguage",function(){return function(a){var b={nb:"Norsk",af:"Afrikaans",bg:"Български език",cs:"Čeština",de:"Deutsch",en:"English",es:"Español",fi:"Suomi",fr:"Français",hr:"Hrvatski",hu:"Magyar",it:"Italiano",nl:"Nederlands",pl:"Polski",pt:"Português",ro:"Română",ru:"Русский язык",tr:"Türkçe",zh:"中文",zxx:"Unknown"};return"undefined"!=typeof b[a]?b[a]:a}}),angular.module("bmmLibApp").filter("bmmCover",function(){return function(a,b){if(null===a)if("undefined"==typeof b)a="fallback_images/svg/person.svg";else switch(b){case"speech":a="fallback_images/svg/speech.svg";break;case"song":case"singsong":case"audiobook":a="fallback_images/svg/song.svg";break;case"video":a="fallback_images/svg/video.svg";break;case"contributor":a="fallback_images/svg/person.svg";break;case"album":a="fallback_images/svg/album.svg";break;default:a="fallback_images/svg/bmm.svg"}return a}}),angular.module("bmmLibApp").directive("bmmTreeview",["$compile",function(a){return{restrict:"A",link:function(b,c,d){var e=d.treeId,f=d.admin,g=d.bmmTreeview,h=d.nodeId||"id",i=d.nodeLabel||"label",j=d.nodeChildren||"children",k='<ul><li ng-show="{{admin}}"><i class="new-track" ng-hide="node.group==\'year\'||node.group==undefined" ng-click="node.newTrack=true;node.newAlbum=false;">Ny Track</i><i class="new-album" ng-hide="node.group==\'year\'" ng-click="node.newAlbum=true;node.newTrack=false;">Nytt album</i><form ng-show="node.newTrack" ng-submit="addTrack(node);"><input placeholder="Track tittel" ng-model="node.title" type="text"><input type="submit" value="" class="bmm-confirm"><div class="bmm-remove" ng-click="node.newTrack = false"></div></form><form ng-show="node.newAlbum" ng-submit="addAlbum(node);"><input placeholder="Album tittel" ng-model="node.title" type="text"><input type="submit" value="" class="bmm-confirm"><div class="bmm-remove" ng-click="node.newAlbum = false"></div></form></li><li data-ng-repeat="node in '+g+"\"id=\"{{node.roleId}}\" language=\"{{node.language}}\" type=\"{{node.group}}\"ng-class=\"{draggable: node.group=='track', 'admin-draggable': ((node.group=='album'||node.group=='track')&&admin), 'admin-droppable': (node.group!='track'&&admin)}\"><i class=\"collapsed\" data-ng-show=\"(node.group=='album'||node.group=='year') && node.collapsed\" data-ng-click=\""+e+'.selectNodeHead(node)"></i><i class="expanded" data-ng-show="(node.group==\'album\'||node.group==\'year\') && !node.collapsed" data-ng-click="'+e+'.selectNodeHead(node)"></i><i class="normal" data-ng-hide="(node.group==\'album\'||node.group==\'year\')"></i> <span data-ng-class="node.selected" data-ng-click="'+e+'.selectNodeLabel(node)">{{node.'+i+'}}</span><div data-ng-hide="node.collapsed" data-tree-id="'+e+'" data-bmm-treeview="node.'+j+'" data-node-id='+h+" data-node-label="+i+" data-node-children="+j+"></div></li></ul>";e&&g&&(d.bmmLibApp&&(b.admin=f||!1,b[e]=b[e]||{},b[e].selectNodeHead=b[e].selectNodeHead||function(a){a.collapsed=!a.collapsed,b[e].expandedNode=a},b[e].selectNodeLabel=b[e].selectNodeLabel||function(a){b[e].currentNode&&b[e].currentNode.selected&&(b[e].currentNode.selected=void 0),a.selected="selected",b[e].currentNode=a}),c.html("").append(a(k)(b)))}}}]),angular.module("bmmLibApp").factory("bmmFormatterAlbum",[function(){var a={};return a.resolve=function(a){var b={};return b.cover=a.cover,null===b.cover&&(b.cover="fallback_images/svg/album.svg"),b.title=a.title,b.id=a.id,b.description=null!==a.description?a.description:"Ingen informasjon",b},a}]),angular.module("bmmLibApp").factory("bmmFormatterTrack",["bmmUser",function(a){var b={},c=a.getTranslation();return b.resolve=function(a){var b={};if("undefined"!=typeof a.cover)b.cover=a.cover;else if("undefined"!=typeof a._meta&&"undefined"!=typeof a._meta.parent&&"undefined"!=typeof a._meta.parent.cover&&null!==a._meta.parent.cover)b.cover=a._meta.parent.cover;else switch(a.subtype){case"speech":b.cover="fallback_images/svg/speech.svg";break;case"song":case"singsong":case"audiobook":b.cover="fallback_images/svg/song.svg";break;case"video":b.cover="fallback_images/svg/video.svg";break;default:b.cover="fallback_images/svg/person.svg"}if(b.parentTitle="undefined"!=typeof a._meta&&"undefined"!=typeof a._meta.parent&&"undefined"!=typeof a._meta.parent.title?a._meta.parent.title:"","undefined"!=typeof a.media&&a.media.length>0&&$.each(a.media,function(){b.file=this.files[0].url,b.duration=Number(this.files[0].length),b.type=this.type,"video"===this.type}),b.title="","undefined"!=typeof a.title&&(b.title=a.title),"undefined"!=typeof a.rel){b.relations={},$.each(a.rel,function(){var a=this;"undefined"==typeof b.relations[a.type]&&(b.relations[a.type]=[]);var c={};for(var d in a)"type"!==d&&(c[d]=a[d]);b.relations[a.type].push(c)}),b.performers="",b.bible="",b.unsorted="",$.each(b.relations,function(a){switch(a){case"interpret":$.each(b.relations[a],function(d){b.performers+=b.relations[a].length-1===d?this.name:b.relations[a].length-2===d?this.name+" "+c.track.and+" ":this.name+", "});break;case"bible":$.each(b.relations[a],function(d){b.bible+=b.relations[a].length-1===d?this.book+" "+this.chapter+":"+this.verse:b.relations[a].length-2===d?this.book+" "+this.chapter+":"+this.verse+" "+c.track.and+" ":this.book+" "+this.chapter+":"+this.verse+", "});break;default:b.unsorted+="<b>"+a+":</b> ",$.each(b.relations[a],function(d){b.unsorted+=b.relations[a].length-1===d?this.name:b.relations[a].length-2===d?this.name+" "+c.track.and+" ":this.name+", "}),b.unsorted+="<br>"}}),b.id=a.id,b.language=a.language,b.date=a.published_at,b.subtype=a.subtype;var d=" - ";""===b.performers&&""===b.title?d=c.track.unknown:(""===b.performers||""===b.title)&&(d=""),b.combinedTitle="speech"===b.subtype?b.performers+d+b.title:b.title+d+b.performers,""===b.title&&(b.title=c.track.unknown)}return b},b}]),angular.module("bmmLibApp").factory("bmmPlay",["bmmPlaylist","bmmPlayer","$location",function(a,b,c){var d={};return d.setPlay=function(d,e,f){"undefined"==typeof e&&(e=0),"undefined"==typeof f&&(f=!0);var g,h,i,j=[];$.each(d,function(){g=!1,"video"===this.type&&(g=!0),h=this.title,i=this.performers,"speech"===this.subtype&&(h=this.performers,i=this.title),j.push({title:h,subtitle:i,extra:this.language,cover:this.cover,url:this.file,duration:this.duration,video:g})}),a.setTracks({tracks:j,index:e,url:c.path()}),f&&(b.setSource(a.getCurrent()),b.setPlay())},d}]),angular.module("bmmLibApp").filter("bmmFilePath",["bmmApi",function(a){return function(b){return"http"!==b.substring(0,4)&&(b=a.getserverUrli()+"file/protected/"+b),b}}]);